# –°–≤–æ–¥–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Backend –∫ Admin Panel

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –£–¥–∞–ª–µ–Ω—ã –º–æ–∫–∞–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—à–±–æ—Ä–¥–∞

- **–§–∞–π–ª**: `apps/admin-panel/src/hooks/useDashboard.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ API
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–µ–ø–µ—Ä—å –¥–∞—à–±–æ—Ä–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º API

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞

- **–§–∞–π–ª**: `apps/admin-panel/src/pages/Auth/LoginPage.tsx`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –ö–Ω–æ–ø–∫–∞ "–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏" —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ (`import.meta.env.DEV`)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í production –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ OAuth –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Yandex

### 3. –°–æ–∑–¥–∞–Ω MarkModule –¥–ª—è Backend

- **–§–∞–π–ª**: `services/mark-service/src/modules/mark.module.ts` (–ù–û–í–´–ô)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- **–í–∫–ª—é—á–∞–µ—Ç**:
  - MarkController
  - MarkService
  - MarkGeneratorService
  - QrCodeService
  - AuditService
  - CacheService
  - MetricsService

### 4. –°–æ–∑–¥–∞–Ω DashboardModule –¥–ª—è Backend

- **–§–∞–π–ª—ã**:
  - `services/mark-service/src/modules/dashboard.module.ts` (–ù–û–í–´–ô)
  - `services/mark-service/src/controllers/dashboard.controller.ts` (–ù–û–í–´–ô)
  - `services/mark-service/src/services/dashboard.service.ts` (–ù–û–í–´–ô)
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
  - `GET /api/v1/dashboard/metrics` - –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
  - `GET /api/v1/dashboard/recent-activity` - –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

- **–ú–µ—Ç—Ä–∏–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞**:
  - `totalMarks` - –≤—Å–µ–≥–æ –º–∞—Ä–æ–∫
  - `activeMarks` - –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä–æ–∫
  - `blockedMarks` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ä–æ–∫
  - `expiredMarks` - –∏—Å—Ç–µ–∫—à–∏—Ö –º–∞—Ä–æ–∫
  - `usedMarks` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ä–æ–∫
  - `todayGenerated` - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è
  - `todayValidated` - –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è
  - `generatedTrend` - —Ç—Ä–µ–Ω–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (% –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç –≤—á–µ—Ä–∞)
  - `validatedTrend` - —Ç—Ä–µ–Ω–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (% –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç –≤—á–µ—Ä–∞)

### 5. –û–±–Ω–æ–≤–ª–µ–Ω AppModule

- **–§–∞–π–ª**: `services/mark-service/src/app.module.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã MarkModule –∏ DashboardModule –≤ imports
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–µ–ø–µ—Ä—å –≤—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

## üîß –†–∞–±–æ—Ç–∞ –∫–Ω–æ–ø–æ–∫ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ö–Ω–æ–ø–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ ‚úÖ

- **–ö–Ω–æ–ø–∫–∞ "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"**: —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `useBlockMark()` ‚Üí `PUT /api/v1/marks/:markCode/block`
- **–ö–Ω–æ–ø–∫–∞ "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"**: —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `useUnblockMark()` ‚Üí `PUT /api/v1/marks/:markCode/unblock`
- **–ú–∞—Å—Å–æ–≤–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `useBulkBlockMarks()` ‚Üí `POST /api/v1/marks/bulk-block`
- **–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `useBulkUnblockMarks()` ‚Üí `POST /api/v1/marks/bulk-unblock`

### –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π ‚úÖ

–ö–Ω–æ–ø–∫–∞ "–î–µ–π—Å—Ç–≤–∏—è" –≤ —Ç–∞–±–ª–∏—Ü–µ MarksPage –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:

- **–î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä–æ–∫**: –∫–Ω–æ–ø–∫–∞ "–ë–ª–æ–∫" (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å)
- **–î–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ä–æ–∫**: –∫–Ω–æ–ø–∫–∞ "–†–∞–∑–±–ª–æ–∫" (—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å)
- **–î–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö**: –∫–Ω–æ–ø–∫–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

## üåê –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ ‚úÖ

### Frontend

- **MarksPage.tsx**:

  ```typescript
  const statusLabels: Record<MarkStatus, string> = {
    active: '–ê–∫—Ç–∏–≤–Ω–∞—è',
    blocked: '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞',
    expired: '–ò—Å—Ç–µ–∫–ª–∞',
    used: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞',
  };
  ```

- **–§–∏–ª—å—Ç—Ä—ã**:
  - –ê–∫—Ç–∏–≤–Ω—ã–µ
  - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
  - –ò—Å—Ç–µ–∫—à–∏–µ
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ

- **Dashboard.tsx**:
  - –í—Å–µ–≥–æ –º–∞—Ä–æ–∫
  - –ê–∫—Ç–∏–≤–Ω—ã–µ
  - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
  - –ò—Å—Ç–µ–∫—à–∏–µ
  - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è
  - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è

### Backend

–°—Ç–∞—Ç—É—Å—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (—ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞):

- `active`
- `blocked`
- `expired`
- `used`

## üìã API Endpoints (Backend)

### Marks API

- `POST /api/v1/marks/generate` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ä–æ–∫
- `GET /api/v1/marks` - —Å–ø–∏—Å–æ–∫ –º–∞—Ä–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- `GET /api/v1/marks/:id` - –ø–æ–ª—É—á–∏—Ç—å –º–∞—Ä–∫—É –ø–æ ID
- `GET /api/v1/marks/code/:markCode` - –ø–æ–ª—É—á–∏—Ç—å –º–∞—Ä–∫—É –ø–æ –∫–æ–¥—É
- `PUT /api/v1/marks/:markCode/block` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä–∫—É
- `PUT /api/v1/marks/:markCode/unblock` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä–∫—É
- `POST /api/v1/marks/bulk-block` - –º–∞—Å—Å–æ–≤–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- `POST /api/v1/marks/bulk-unblock` - –º–∞—Å—Å–æ–≤–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- `POST /api/v1/marks/validate` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–∞—Ä–∫–∏
- `GET /api/v1/marks/expiring/list` - —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –º–∞—Ä–æ–∫

### Dashboard API (–ù–û–í–´–ï)

- `GET /api/v1/dashboard/metrics` - –º–µ—Ç—Ä–∏–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞
- `GET /api/v1/dashboard/recent-activity` - –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
cd services/mark-service
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ `services/mark-service/.env` –µ—Å—Ç—å:

```env
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_NAME=znak_lavki
DB_POOL_MAX=20
DB_POOL_MIN=5

REDIS_ENABLED=true
REDIS_HOST=localhost
REDIS_PORT=6379

NODE_ENV=development
PORT=3001
```

### 3. –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
docker-compose up -d postgres redis
```

### 4. –ó–∞–ø—É—Å–∫ backend

```bash
cd services/mark-service
npm run start:dev
```

Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:3001`

### 5. –ó–∞–ø—É—Å–∫ frontend

```bash
cd apps/admin-panel
npm run dev
```

Frontend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:5173`

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:5173`
2. –ù–∞–∂–º–∏—Ç–µ "üîß –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–±–µ–∑ OAuth)"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—à–±–æ—Ä–¥ - –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –º–µ—Ç—Ä–∏–∫–∏
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–∞–º–∏"
5. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∞—Ä–æ–∫
6. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä–∫—É
7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Failed to fetch" –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3001

```bash
curl http://localhost:3001/api/v1/dashboard/metrics
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ö–Ω–æ–ø–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ MarkModule –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ AppModule

- –û—Ç–∫—Ä–æ–π—Ç–µ `services/mark-service/src/app.module.ts`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `MarkModule` –∏ `DashboardModule` –≤ —Å–ø–∏—Å–∫–µ imports

### –ü—Ä–æ–±–ª–µ–º–∞ 3: CORS –æ—à–∏–±–∫–∞

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤—å—Ç–µ CORS –≤ `services/mark-service/src/main.ts`:

```typescript
app.enableCors({
  origin: 'http://localhost:5173',
  credentials: true,
});
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞

**–†–µ—à–µ–Ω–∏–µ**:

```bash
docker-compose ps  # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose up -d postgres  # –∑–∞–ø—É—Å—Ç–∏—Ç—å postgres
```

## ‚ú® –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ:

- ‚ùå –î–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–ª mock –¥–∞–Ω–Ω—ã–µ
- ‚ùå MarkController –Ω–µ –±—ã–ª –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
- ‚ùå DashboardController –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª
- ‚ùå –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤ production

### –ü–æ—Å–ª–µ:

- ‚úÖ –î–∞—à–±–æ—Ä–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º API
- ‚úÖ MarkModule –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ AppModule
- ‚úÖ DashboardModule —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –≤ dev
- ‚úÖ –ö–Ω–æ–ø–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ —Ä—É—Å—Å–∫–∏–π
- ‚úÖ –í—Å–µ endpoints –ø–æ–¥–∫–ª—é—á–µ–Ω—ã

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ. Backend –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –î–ª—è production –¥–µ–ø–ª–æ—è –Ω–µ –∑–∞–±—É–¥—å—Ç–µ:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth Yandex
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å production –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL/TLS
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting
6. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)
