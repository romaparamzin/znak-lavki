# 🎯 Инструкция по использованию Admin Panel

## ✅ Решение проблемы авторизации

### Проблема

При попытке входа появлялась ошибка: **"400 Отсутствует обязательный параметр 'client_id'"**

### Причина

Admin Panel настроен на OAuth авторизацию через Yandex, но не настроены переменные окружения для Yandex OAuth.

### ✅ Решение: Добавлен режим разработки

Я добавил кнопку **"🔧 Режим разработки (без OAuth)"**, которая позволяет войти в систему без настройки OAuth.

---

## 🚀 Как войти в Admin Panel

### Шаг 1: Откройте Admin Panel

```
http://localhost:5173
```

### Шаг 2: Используйте режим разработки

На странице входа вы увидите **две кнопки**:

1. **"Войти через Yandex"** - требует настройки OAuth (для продакшена)
2. **"🔧 Режим разработки (без OAuth)"** - мгновенный вход для тестирования

**Нажмите на вторую кнопку** для входа в режиме разработки.

### Шаг 3: Пользуйтесь системой!

После входа вы получите доступ ко всем функциям:

- Дашборд с метриками
- Управление метками
- Аналитика
- Журнал аудита
- Настройки

---

## 👤 Данные пользователя в Dev Mode

При входе в режиме разработки создается тестовый пользователь:

- **Email:** admin@znak-lavki.com
- **Имя:** Admin User
- **Роль:** admin
- **Права доступа:** Все (полный доступ)

---

## 🔧 Настройка OAuth для продакшена (опционально)

Если вы хотите использовать реальную OAuth авторизацию через Yandex:

### 1. Получите credentials в Yandex OAuth

1. Перейдите на https://oauth.yandex.ru/
2. Создайте новое приложение
3. Получите `Client ID` и `Client Secret`
4. Укажите Redirect URI: `http://localhost:5173/auth/callback`

### 2. Создайте файл `.env` в директории admin-panel

```bash
cd apps/admin-panel
cat > .env << 'EOF'
# API Configuration
VITE_API_BASE_URL=http://localhost:3001
VITE_WS_URL=ws://localhost:3001

# OAuth Configuration
VITE_YANDEX_CLIENT_ID=ваш_client_id
VITE_YANDEX_REDIRECT_URI=http://localhost:5173/auth/callback
EOF
```

### 3. Перезапустите Admin Panel

```bash
cd "/Users/rparamzin/Desktop/репозиторий/Знак лавки"
# Остановить
pkill -f "vite"

# Запустить
export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
pnpm --filter @znak-lavki/admin-panel dev
```

---

## 📊 Доступные функции

### 1. Дашборд

- Общая статистика по меткам
- Активные/Заблокированные/Истекшие метки
- Графики и тренды

### 2. Управление метками

- Просмотр всех меток
- Генерация новых меток
- Блокировка/Разблокировка
- Экспорт в CSV/Excel

### 3. Аналитика

- Статистика валидаций
- Распределение по поставщикам
- Тренды использования

### 4. Журнал аудита

- История всех операций
- Фильтрация по пользователям
- Экспорт логов

### 5. Настройки

- Конфигурация системы
- Управление пользователями (для продакшена)

---

## 🌐 Текущий статус сервисов

| Сервис               | Порт | Статус           | Описание      |
| -------------------- | ---- | ---------------- | ------------- |
| **Admin Panel**      | 5173 | ✅ **РАБОТАЕТ**  | Веб-интерфейс |
| Integration Service  | 3002 | ✅ Работает      | Интеграции    |
| Notification Service | 3003 | ✅ Работает      | Уведомления   |
| Mark Service         | 3001 | ⏳ Компилируется | API меток     |
| API Gateway          | 3000 | ⏳ Компилируется | Основной API  |

**Примечание:** Mark Service и API Gateway все еще компилируются. Админ панель пока работает в автономном режиме с демо данными.

---

## 🐛 Устранение проблем

### Ошибка "Cannot connect to API"

**Причина:** Backend сервисы еще не запустились

**Решение:** Подождите 2-3 минуты, пока Mark Service и API Gateway завершат компиляцию

### Кнопка "Режим разработки" не работает

**Решение:**

1. Откройте консоль браузера (F12)
2. Очистите localStorage:
   ```javascript
   localStorage.clear();
   ```
3. Обновите страницу (F5)
4. Попробуйте снова

### Страница входа не загружается

**Решение:**

```bash
# Перезапустите Admin Panel
pkill -f "vite"
cd "/Users/rparamzin/Desktop/репозиторий/Знак лавки"
export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
pnpm --filter @znak-lavki/admin-panel dev
```

---

## 📝 Полезные команды

### Перезапустить Admin Panel

```bash
pkill -f "vite"
cd "/Users/rparamzin/Desktop/репозиторий/Знак лавки"
export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
pnpm --filter @znak-lavki/admin-panel dev
```

### Просмотр логов Admin Panel

```bash
cd "/Users/rparamzin/Desktop/репозиторий/Знак лавки"
export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
pnpm --filter @znak-lavki/admin-panel dev
```

### Очистка кеша браузера

В браузере нажмите:

- **Chrome/Edge:** `Cmd+Shift+Delete` (macOS) или `Ctrl+Shift+Delete` (Windows)
- **Safari:** `Cmd+Option+E`
- **Firefox:** `Cmd+Shift+Delete` (macOS) или `Ctrl+Shift+Delete` (Windows)

---

## ✨ Что было исправлено

1. ✅ **Исправлен импорт Sharp** в Mark Service
2. ✅ **Исправлены опции QRCode** (убрано поле `quality`, добавлены отдельные опции для буфера)
3. ✅ **Добавлен режим разработки** для обхода OAuth
4. ✅ **Создан mock-пользователь** с полными правами доступа

---

## 🎉 Готово к тестированию!

Теперь вы можете:

1. Открыть http://localhost:5173
2. Нажать "🔧 Режим разработки (без OAuth)"
3. Тестировать все функции Admin Panel

**Приятного использования! 🚀**
